generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id            String   @id @default(cuid())
  firstName     String
  lastName      String
  startDate     DateTime
  birthDate     DateTime
  email         String?  @unique
  status        EmployeeStatus @default(ACTIVE)
  exitDate      DateTime?
  unit          Unit?    @relation(fields: [unitId], references: [id])
  unitId        String?
  lockAll       Boolean  @default(false)
  lockFirstName Boolean  @default(false)
  lockLastName  Boolean  @default(false)
  lockStartDate Boolean  @default(false)
  lockBirthDate Boolean  @default(false)
  lockEmail     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  @@unique([firstName, lastName, birthDate])
}

model Unit {
  id         String     @id @default(cuid())
  name       String
  leader     String?
  deputy     String?
  employees  Employee[]
  users      User[]
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  @@unique([name])
}

enum UserRole {
  ADMIN
  UNIT_LEAD
}

model User {
  id           String    @id @default(cuid())
  email        String    @unique
  name         String?
  passwordHash String
  role         UserRole  @default(UNIT_LEAD)
  unit         Unit?     @relation(fields: [unitId], references: [id])
  unitId       String?
  sessions     Session[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
}

enum EmployeeStatus {
  ACTIVE
  EXITED
}

model Setting {
  id                     Int      @id @default(1)
  managerEmails          String   @default("")
  birthdayEmailTemplate  String   @default("Happy Birthday, {{firstName}}!")
  jubileeEmailTemplate   String   @default("Congrats on {{years}} years, {{firstName}}!")
  jubileeYearsCsv        String   @default("5,10,15,20,25,30,35,40")
  smtpHost               String   @default("")
  smtpPort               Int      @default(465)
  smtpUser               String   @default("")
  smtpPass               String   @default("")
  smtpFrom               String   @default("")
  smtpSecure             Boolean  @default(true)
  smtpRejectUnauthorized Boolean  @default(true)
  sendOnBirthday         Boolean  @default(true)
  sendOnJubilee          Boolean  @default(true)
  dailySendHour          Int      @default(8) // 0-23
}
